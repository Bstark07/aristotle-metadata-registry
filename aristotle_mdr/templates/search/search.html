{% extends 'aristotle_mdr/base.html' %}
{% load i18n %}
{% load bootstrap3 %}
{% load aristotle_tags %}

{% block search %}{% endblock %}
{% block title %}Search{% if query %} results{% endif %}{% endblock %}
{% block content %}
    <form method="get">
        <div class="row">
            <div class="col-sm-8 col-sm-offset-2">
                <div class="input-group">
                    <input type="text" class="form-control" value="{{ form.q.value }}" name="q" accesskey="q"></input>
                    <span class="input-group-btn">
                    <button class="btn btn-primary" type="submit">
                        Search {% bootstrap_icon "search" %}
                    </button>
                    </span>
                </div>
            </div>
        </div>
            <nav id="searchAdvanced" class="col-sm-4 col-md-3 navbar navbar-default pull-left;">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#search-advanced">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                  </button>
                  <a href="#" class="navbar-brand">
                    <i class="fa fa-cogs fa-fw"></i>Advanced Options
                  </a>
                </div>
                <dl class="collapse navbar-collapse" id="search-advanced">
                    {% if user.is_active %}
                    {% comment %}
                        Only logged in users have workgroups.
                        If you aren't logged in you can *only* see public items.
                    {% endcomment %}
                    <dt>Only show</dt>
                    <dd>
                        <ul>
                            <li>
                            {{ form.public_only }}
                            {{ form.public_only.label }}
                            </li>
                            <li>
                            {{ form.myWorkgroups_only }}
                            {{ form.myWorkgroups_only.label }}
                            </li>
                        </ul>
                    </dd>
                    {% endif %}
                    {% with show=form.models.data %}
                        <dt data-toggle="collapse" data-target="#search-models"
                            {% if not show %}class="collapsed"{% endif %}>
                            Item type
                        </dt>
                        <dd id="search-models" {% if not show %}class="collapse"{% endif %}>
                            {{ form.models }}
                        </dd>
                    {% endwith %}
                    {% with show=form.state.data %}
                        <dt data-toggle="collapse" data-target="#search-states"
                            {% if not show %}class="collapsed"{% endif %}>
                            State
                        </dt>
                        <dd id="search-states" {% if not show %}class="collapse"{% endif %}>
                            {{ form.state }}
                        </dd>
                    {% endwith %}
                    {% with show=form.ra.data %}
                        <dt data-toggle="collapse" data-target="#search-ras"
                            {% if not show %}class="collapsed"{% endif %}>
                            Registration Authority
                        </dt>
                        <dd id="search-ras" {% if not show %}class="collapse"{% endif %}>
                            {{ form.ra }}
                        </dd>
                    {% endwith %}
                    {% comment %}
                    <div>
                    Modified:
                    <ul></ul>
                    Custom range:
                    {{ form.startDate }}
                    </div>
                    <div>
                    Created:
                    <ul></ul>
                    Custom range:
                    {{ form.startDate }}
                    </div>
                    {% endcomment %}
                </dl>
            </nav>
    <!-- /form -->
            <div class="col-sm-8 col-md-9">

        {% if query %}
            <h3>Results</h3>
            <p>
                {% if page.has_other_pages %}
                Showing {{ page.start_index }} - {{ page.end_index }} of {{ page.paginator.count }} results.
                {% else %}
                Showing {{ page.paginator.count }} results.
                {% endif %}
            </p>
            <!-- form method="post" action="{% url 'aristotle:bulkFavourite'%}">
            {% if user.is_active %}
                {% csrf_token %}
            {% endif %} -->
            <ol start="{{ page.start_index }}"
                class="searchResults {% ternary user.is_active 'active' '' %}">
            {% for result in page.object_list %}
                {% if result.object.name %}
                <li>
                    {% if user.is_active %}
                        <input type='checkbox' value='{{ result.object.id }}' title='select to add to favourites' name='favourites'></input>
                    {% endif %}
                    <a href="{% url 'aristotle:item' result.object.id %}">{{ result.object.name }}</a> ({{ result.object.get_verbose_name }})
                    <div>
                    <span class="attr">Last modified: {{ result.object.modified }}</span>
                    <span class="attr">Statuses:
                        {% for s in result.object.statuses.all %}
                            [{{ s.registrationAuthority }}: {{ s.state_name }}]
                        {% endfor %}</span>
                    {{ result.object.description|truncatewords:20|striptags }}</div>
                </li>
                {% endif %}
            {% empty %}
                <li>No results found.</li>
            {% endfor %}
            </ol>
            {% if user.is_active %}
            <button class="btn btn-primary" type="submit" name="addFavourites">
                <i class="fa fa-bookmark"></i> Add selected to favourites
            </button>
            {% endif %}
            {% if page.has_previous or page.has_next %}
                {% if page.paginator.num_pages <= 10 %}
                <ul class="pagination pagination-sm searchResults">
                    {% if page.has_previous %}
                        <li><a href="?{% search request page.previous_page_number %}">&laquo; Previous</a></li>
                    {% endif %}
                    {% for p in page.paginator.page_range %}
                        <li><a href="?{% search request p %}">{{ p }}</a></li>
                    {% endfor %}
                    {% if page.has_next %}
                        <li><a href="?{% search request page.next_page_number %}">Next &raquo;</a></li>
                    {% endif %}
                </ul>
                {% else %}
                <ul class="pagination pagination-sm searchResults">
                    {% if page.has_previous %}
                        <li><a href="?{% search request page.previous_page_number %}">&laquo; Previous</a></li>
                    {% endif %}
                    {% for p in page|search_paginator:"start" %}
                        <li {% ifeq p page.number 'class="active"' %}><a href="?{% search request p %}" >{{ p }}</a></li>
                    {% endfor %}
                    {% if page.number > 6 %}
                        <li><a>...</a></li>
                    {% endif %}
                    {% for p in page|search_paginator:"middle" %}
                        <li {% ifeq p page.number 'class="active"' %}><a href="?{% search request p %}">{{ p }}</a></li>
                    {% endfor %}
                     <li><a>...</a></li>
                    {% for p in page|search_paginator:"end" %}
                        <li {% ifeq p page.number 'class="active"' %}><a href="?{% search request p %}">{{ p }}</a></li>
                    {% endfor %}
                    {% if page.has_next %}
                        <li><a href="?{% search request page.next_page_number %}">Next &raquo;</a></li>
                    {% endif %}
                </ul>
                {% endif %}
            {% endif %}
        {% else %}
            {# Show some example queries to run, maybe query syntax, something else? #}
        {% endif %}

        </div>
</form>
{% endblock %}
