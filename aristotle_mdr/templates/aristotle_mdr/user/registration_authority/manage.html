{% extends "aristotle_mdr/user/userHome.html" %}
{% load i18n aristotle_tags %}

{% block collapse-link %}
    <i class="fa fa-users fa-fw"></i> All Registration Authorities </a>
{% endblock %}

{% block sidebar %}
    {% include "aristotle_mdr/user/userSideBar.html" with activeTab='adminTools' %}
{% endblock %}

{% block page %}
<h1>{% block title %}{{ item.name }}{% endblock %}</h1>

    <section id="workgroups">
        <div class="btn-group pull-right" role="group" aria-label="...">

            <a class="btn btn-default" href="{% url 'aristotle:registrationauthority_edit' item.pk %}">Edit</a>
            <a class="btn btn-primary" href="{{ item.get_absolute_url }}">View public page</a>
            <a class="btn btn-success" href="{% url 'aristotle:registrationauthority_add_user' item.pk %}"
                data-toggle="modal" data-target="#ra_page_modal">Invite a user</a>
        </div>

    <div class="row">
    <div class="col-lg-8">
        <header>Description</header>
        <div class="well">{{ item.definition|safe }}</div>

    <header>Members</header>
        <div class="btn-group pull-right" role="group" aria-label="...">
        </div>

    <table class="table">
        <thead>
            <th>Member</th>
            <th>Roles</th>
            <th>Manage</th>
        </thead>
        <tbody>

        {% for member in item.members.all %}
        <tr>
        <td>
            {% include "aristotle_mdr/users_management/helper/user_table_display.html" with user=member %}
        </td>
        <td>
            {% comment %}
            TODO: THIS IS SUPER INEFFICIENT AND USES 4 DATABASE CALLS BUT WORKS.
            PROFILE AND FIX IN THE FUTURE.
            {% endcomment %}
            {% if member in item.managers.all %}
            Manager
            {% endif %}
            {% if member in item.managers.all and member in item.registrars.all %}
            ,
            {% endif %}
            {% if member in item.registrars.all %}
            Registrar
            {% endif %}
        </td>
        <td>
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fa fa-cog"></i>
                <span class="sr-only">Manage permissions for {{ member }}</span>
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu pull-right">
                <li>
                    <a href="{% url 'aristotle:registrationauthority_change_user_roles' item.id  member.pk %}"
                        data-toggle="modal" data-target="#ra_page_modal">Change role</a>
                </li>
                {% comment %}
                <li role="separator" class="divider"></li>
                <li class="alert-danger">
                    <a href="{#% url 'aristotle-user:remove_ra_user' %#}?deactivate_user={{user.pk}}">Remove from this group</a>
                </li>
                {% endcomment %}
              </ul>
            </div>
        </td>
        </tr>
        {% empty %}
        <tr>
        <td>No members</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
    <div class="col-lg-4">
    <header>
        Status definitions
    </header>
    <p>
        Click a status name to search for all metadata with that registration status.
    </p>
    <dl class="status_definitions">
        {% for visiblity,descriptions in item.statusDescriptions %}
            <dt>
                {{ visiblity|title }}

                {% if visiblity == "unlocked" %}
                <i class="fa fa-unlock"></i>
                {% elif visiblity == "locked" %}
                <i class="fa fa-lock"></i>
                {% elif visiblity == "public" %}
                <i class="fa fa-eye"></i>
                {% else %}
                <i class="fa fa-bug"></i>
                {% endif %}
            </dt>
            <dd>
            <dl>
                {% for val,state_name,text in descriptions %}
                <dt id='state_{{ val }}'>
                    <a href="{% url 'aristotle:search' %}?q=&ra={{item.id}}&state={{ val }}">{{ state_name }}</a>
                </dt>
                <dd>
                {% if text %}
                    {{ text | linebreaks }}
                {% else %}
                    <em>No description given</em>
                {% endif %}
                </dd>
                {% endfor %}
            </dl>
            </dd>
        {% endfor %}
    </dl>
    </div>
    </div>

</section>

{% bootstrap_modal "ra_page_modal" size='lg' %}
{% endblock %}
